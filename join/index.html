<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Creator - Persona Core</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #1d1d1f;
            background: #f5f5f7;
        }

        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e5e7;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            height: 30px;
            width: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 140px 20px 80px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 600px;
            height: 600px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .hero-content {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 10px;
            opacity: 0.95;
        }

        .creator-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* Pricing section - completely separate from hero */
        .pricing-section {
            padding: 80px 20px;
            background: white;
        }

        .pricing-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1d1d1f;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: #86868b;
            margin-bottom: 50px;
        }

        .signup-card {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
        }

        .pricing-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-radius: 24px 24px 0 0;
        }

        .price {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .price-period {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .features {
            padding: 20px 30px;
            background: #f5f5f7;
            text-align: center;
        }

        .features ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .features li {
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .features li:before {
            content: "‚úì ";
            font-weight: 700;
        }

        .form-section {
            padding: 40px;
            border-radius: 0 0 24px 24px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .payment-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 16px;
            margin: 30px 0;
            border: 2px solid #e5e5e7;
        }

        .payment-section h3 {
            margin-bottom: 15px;
            color: #1d1d1f;
            font-size: 1.1rem;
        }

        .btn {
            padding: 16px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            display: inline-block;
            width: 100%;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            color: #86868b;
        }

        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .security {
            text-align: center;
            margin-top: 20px;
            color: #86868b;
            font-size: 0.9rem;
        }

        .security:before {
            content: "üîí ";
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid #fcc;
            display: none;
        }

        .success-message {
            background: #efe;
            color: #363;
            padding: 12px 16px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid #cfc;
            display: none;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .signup-card {
                margin: 0 20px;
                border-radius: 20px;
            }
            
            .form-section {
                padding: 30px 25px;
                border-radius: 0 0 20px 20px;
            }

            .pricing-header {
                border-radius: 20px 20px 0 0;
                padding: 30px 20px;
            }
        }
    </style>

    <!-- Include Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-content">
            <img src="https://movietwin-widget.pages.dev/assets/personacore-logo.png" alt="Persona Core" class="logo">
            <div>
                <a href="https://personacore.io" style="text-decoration: none; color: #1d1d1f; font-weight: 500;">
                    ‚Üê Back to Persona Core
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section - Just the creator intro -->
    <section class="hero">
        <div class="hero-content">
            <h1 id="creator-name">Chat with Creator</h1>
            <div class="creator-badge" id="creator-badge">AI Twin</div>
            <p id="creator-description">Get 24/7 access to personalized conversations</p>
        </div>
    </section>

    <!-- Separate Pricing & Signup Section -->
    <section class="pricing-section">
        <div class="pricing-container">
            <h2 class="section-title">Start Chatting Today</h2>
            <p class="section-subtitle">Join thousands of fans chatting with AI twins</p>
            
            <div class="signup-card">
                <!-- Pricing Header -->
                <div class="pricing-header">
                    <div class="price">¬£5</div>
                    <div class="price-period">per month</div>
                </div>

                <!-- Features -->
                <div class="features">
                    <ul>
                        <li>1,000 messages/month</li>
                        <li>24/7 access</li>
                        <li>Cancel anytime</li>
                    </ul>
                </div>

                <!-- Messages -->
                <div class="error-message" id="error-message"></div>
                <div class="success-message" id="success-message"></div>

                <!-- Signup Form -->
                <div class="form-section">
                    <form id="fan-signup-form">
                        <div class="form-group">
                            <label for="fan-email">Email Address</label>
                            <input type="email" id="fan-email" class="form-input" placeholder="your.email@example.com" required>
                        </div>

                        <div class="form-group">
                            <label for="fan-username">Username</label>
                            <input type="text" id="fan-username" class="form-input" placeholder="Choose a username (letters, numbers, _- only)" required>
                            <small style="color: #86868b; font-size: 0.8rem;">No spaces allowed. Only letters, numbers, hyphens, and underscores.</small>
                        </div>

                        <div class="form-group">
                            <label for="fan-password">Password</label>
                            <input type="password" id="fan-password" class="form-input" placeholder="Create a secure password" required>
                        </div>

                        <!-- Payment Section -->
                        <div class="payment-section">
                            <h3>Payment Method</h3>
                            <div style="text-align: center; color: #86868b; padding: 20px; background: white; border-radius: 8px;">
                                Secure payment handled by Stripe
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            Start Chatting - ¬£5/month
                        </button>

                        <div class="security">
                            Secure payment powered by Stripe
                        </div>

                        <div class="login-link">
                            Already have an account? <a href="#" id="login-link">Sign in</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
    let supabase;
    let appInitialized = false;

    // Simple Supabase initialization
    async function initializeSupabase() {
        console.log('Starting Supabase initialization...');
        
        try {
            // Use the global supabase from the CDN
            if (window.supabase) {
                console.log('Supabase found in window object');
                const supabaseUrl = 'https://hmcartafonsppirzmtoq.supabase.co'; // REPLACE WITH YOUR URL
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtY2FydGFmb25zcHBpcnptdG9xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NTY3NDgsImV4cCI6MjA3NjMzMjc0OH0.EaMPCzwnnCN0R-S_AzNrFVAAn2AYU030Cx_5vS9vYpg'; // REPLACE WITH YOUR KEY
                
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                console.log('Supabase initialized successfully');
                return true;
            } else {
                console.log('Supabase not in window, trying dynamic import...');
                // Fallback: dynamic import
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                const supabaseUrl = 'https://hmcartafonsppirzmtoq.supabase.co'; // REPLACE WITH YOUR URL
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtY2FydGFmb25zcHBpcnptdG9xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NTY3NDgsImV4cCI6MjA3NjMzMjc0OH0.EaMPCzwnnCN0R-S_AzNrFVAAn2AYU030Cx_5vS9vYpg'; // REPLACE WITH YOUR KEY
                
                supabase = createClient(supabaseUrl, supabaseKey);
                console.log('Supabase initialized via dynamic import');
                return true;
            }
        } catch (error) {
            console.error('Supabase initialization failed:', error);
            return false;
        }
    }

    // Get creator slug from URL
    function getCreatorSlugFromURL() {
        const path = window.location.pathname;
        const parts = path.split('/');
        return parts[2];
    }

    // Show error message
    function showError(message) {
        const errorEl = document.getElementById('error-message');
        if (errorEl) {
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
    }

    // Show success message
    function showSuccess(message) {
        const successEl = document.getElementById('success-message');
        if (successEl) {
            successEl.textContent = message;
            successEl.style.display = 'block';
        }
    }

    // Set loading state
    function setLoading(loading) {
        const btn = document.getElementById('submit-btn');
        if (btn) {
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = 'Processing...';
            } else {
                btn.disabled = false;
                btn.innerHTML = 'Start Chatting - ¬£5/month';
            }
        }
    }

    // Load creator data
    async function loadCreatorData() {
        if (!supabase) {
            console.error('Cannot load creator: Supabase not initialized');
            return null;
        }

        const creatorSlug = getCreatorSlugFromURL();
        if (!creatorSlug) {
            showError('Invalid creator link.');
            return null;
        }

        try {
            console.log('Loading creator:', creatorSlug);
            const { data: creator, error } = await supabase
                .from('creators')
                .select('display_name, subscription_price_id, bio, slug')
                .eq('slug', creatorSlug)
                .single();

            if (error) throw error;
            if (!creator) throw new Error('Creator not found');

            // Update page
            document.getElementById('creator-name').textContent = `Chat with ${creator.display_name}`;
            document.getElementById('creator-badge').textContent = `AI Twin of ${creator.display_name}`;
            if (creator.bio) {
                document.getElementById('creator-description').textContent = creator.bio;
            }
            document.querySelector('.section-title').textContent = `Chat with ${creator.display_name}'s AI Twin`;

            console.log('Creator loaded:', creator.display_name);
            return creator;

        } catch (error) {
            console.error('Error loading creator:', error);
            showError('Creator not found or not set up yet.');
            return null;
        }
    }

    // Form submission
    async function handleFormSubmit(e) {
        e.preventDefault();
        console.log('Form submission started');
        
        if (!supabase) {
            showError('System not ready. Please refresh.');
            return;
        }
        
        setLoading(true);
        showError('');

        const email = document.getElementById('fan-email').value;
        const username = document.getElementById('fan-username').value;
        const password = document.getElementById('fan-password').value;
        const creator = window.creatorData;

        if (!creator) {
            showError('Please refresh the page.');
            setLoading(false);
            return;
        }

        // Basic validation
        if (!/^[a-zA-Z0-9_-]+$/.test(username)) {
            showError('Invalid username format.');
            setLoading(false);
            return;
        }

        try {
            // Test: Just show success for now
            console.log('Form data valid, showing success message');
            showSuccess('Form is working! Account creation would happen here.');
            setLoading(false);

        } catch (error) {
            console.error('Form error:', error);
            showError('Something went wrong.');
            setLoading(false);
        }
    }

    // Setup event listeners
    function setupEventListeners() {
        const form = document.getElementById('fan-signup-form');
        const loginLink = document.getElementById('login-link');
        
        if (form) {
            form.addEventListener('submit', handleFormSubmit);
            console.log('Form event listener added');
        }
        if (loginLink) {
            loginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showError('Please sign up for a new account.');
            });
        }
    }

    // Main initialization
    async function initializeApp() {
        console.log('=== APP INITIALIZATION STARTED ===');
        
        // Initialize Supabase
        const supabaseReady = await initializeSupabase();
        if (!supabaseReady) {
            showError('Failed to initialize. Please refresh.');
            return;
        }

        // Setup events
        setupEventListeners();

        // Load creator data
        const creator = await loadCreatorData();
        if (creator) {
            window.creatorData = creator;
        }

        appInitialized = true;
        console.log('=== APP INITIALIZATION COMPLETE ===');
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM ready, starting app...');
        initializeApp();
    });

    // Also make sure the Supabase CDN is loaded
    // Add this script tag to your head section if not already there
	
	// Extract creator name from URL
function getCreatorFromPath() {
  const path = window.location.pathname;
  if (path.startsWith('/join/')) {
    const segments = path.split('/').filter(seg => seg.length > 0);
    if (segments.length >= 2) {
      return segments[1]; // Returns "mr-crag" from "/join/mr-crag"
    }
  }
  return null;
}

// Use the creator name
document.addEventListener('DOMContentLoaded', function() {
  const creatorSlug = getCreatorFromPath();
  
  if (creatorSlug) {
    console.log('Loading creator:', creatorSlug);
    // Here you would:
    // 1. Validate the creator exists via your API
    // 2. Pre-fill the form with creator data
    // 3. Update the page title/header
    document.title = `Join ${creatorSlug}'s Community - Persona Core`;
    
    // Example: Set a hidden field or global variable
    window.targetCreator = creatorSlug;
  }
});
</script>
</body>
</html>